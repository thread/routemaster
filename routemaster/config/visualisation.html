<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
body {
  font: 14px helvetica neue, helvetica, arial, sans-serif;
}
#cy {
  height: 100%;
  width: 100%;
  position: absolute;
  left: 0;
  top: 0;
}
#legend > div {
  display: inline-block;
  padding: 0.6em;
  margin: 0.1em;
}
.action {
  background-color: orange;
}
.gate {
  background-color: lightBlue;
}
</style>
<title>Visualisation of state machine {{ state_machine_name }}</title>
</head>
<body>
  <script type="text/javascript">
    var state_machine_config = {{ state_machine_config|tojson }};
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.2.11/cytoscape.js"></script>
  <div id="legend">
    <div class="action">action</div>
    <div class="gate">gate</div>
  </div>
  <div id="cy"></div>
  <script>
    function backgroundColourForNodeClass(nodeClass) {
      var style = getComputedStyle(document.querySelector('#legend ' + nodeClass));
      return style.backgroundColor;
    }

    var cy = cytoscape({
      container: document.querySelector('#cy'),

      boxSelectionEnabled: false,
      autounselectify: true,

      style: cytoscape.stylesheet()
        .selector('node')
          .css({
            'content': 'data(id)',
            'text-valign': 'center',
            'color': 'black',
          })
          .style({
            'shape': 'square',
            'width': 'label',
            'height': 'label',
            'padding': '1em',
          })
        .selector('edge')
          .css({
            'curve-style': 'bezier',
            'target-arrow-shape': 'triangle',
            'target-arrow-color': '#ccc',
            'line-color': '#ccc',
            'width': 1
          })
        .selector(':selected')
          .css({
            'background-color': 'black',
            'line-color': 'black',
            'target-arrow-color': 'black',
            'source-arrow-color': 'black'
          })
        .selector('.action')
          .css({
            'background-color': backgroundColourForNodeClass('.action'),
          })
        .selector('.gate')
          .css({
            'background-color': backgroundColourForNodeClass('.gate'),
          }),

      elements: state_machine_config,

      layout: {
        // http://js.cytoscape.org/#layouts/breadthfirst
        name: 'breadthfirst',
        fit: true,
        directed: true,
        padding: 30,
        spacingFactor: 0.55,
        avoidOverlap: true,
        nodeDimensionsIncludeLabels: false,
      }
    });
  </script>
</body>
</html>
