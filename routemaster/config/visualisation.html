<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>
body {
  font: 14px helvetica neue, helvetica, arial, sans-serif;
}
#cy {
  height: 100%;
  width: 100%;
  position: absolute;
  left: 0;
  top: 0;
}
#info {
  color: #c88;
  font-size: 1em;
  position: absolute;
  z-index: -1;
  left: 1em;
  top: 1em;
}
</style>
<title>Visualisation of state machine {{ state_machine_name }}</title>
</head>
<body>
  <script id="state_machine_config" type="application/json">
    {{ state_machine_config|tojson }}
  </script>
  <script type="text/javascript">
    var state_machine_config = JSON.parse(document.getElementById('state_machine_config').innerHTML);
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.2.11/cytoscape.js"></script>
  <div id="cy"></div>
  <script>
    var cy = cytoscape({
      container: document.querySelector('#cy'),

      boxSelectionEnabled: false,
      autounselectify: true,

      style: cytoscape.stylesheet()
        .selector('node')
          .css({
            'content': 'data(name)',
            'text-valign': 'center',
            'color': 'black',
          })
          .style({
            'shape': 'square',
            'width': 'label',
            'height': 'label',
            'padding': '1em',
          })
        .selector('edge')
          .css({
            'curve-style': 'bezier',
            'target-arrow-shape': 'triangle',
            'target-arrow-color': '#ccc',
            'line-color': '#ccc',
            'width': 1
          })
        .selector(':selected')
          .css({
            'background-color': 'black',
            'line-color': 'black',
            'target-arrow-color': 'black',
            'source-arrow-color': 'black'
          })
        .selector('.action')
          .css({
            'background-color': 'orange',
          })
        .selector('.gate')
          .css({
            'background-color': 'lightBlue',
          }),

      elements: state_machine_config,

      layout: {
        name: 'breadthfirst',
        fit: true, // whether to fit the viewport to the graph
        directed: true, // whether the tree is directed downwards (or edges can point in any direction if false)
        padding: 30, // padding on fit
        circle: false, // put depths in concentric circles if true, put depths top down if false
        spacingFactor: 0.55, // positive spacing factor, larger => more space between nodes (N.B. n/a if causes overlap)
        avoidOverlap: true, // prevents node overlap, may overflow boundingBox if not enough space
        nodeDimensionsIncludeLabels: false, // Excludes the label when calculating node bounding boxes for the layout algorithm
        roots: ['start'], // the roots of the trees
        maximalAdjustments: 0, // how many times to try to position the nodes in a maximal way (i.e. no backtracking)
        animate: false, // whether to transition the node positions
        transform: function ( node, position ){ return position; } // transform a given node position. Useful for changing flow direction in discrete layouts
      }
    });
  </script>
</body>
</html>
